$.extend(edges,{newMapView:function(params){if(!params){params={}}edges.MapView.prototype=edges.newComponent(params);return new edges.MapView(params)},MapView:function(params){this.geoPoint=params.geoPoint||"location";this.structure=params.structure||"properties";this.calculateCentre=params.calculateCentre||edges.MapCentreFunctions.pickFirst;this.defaultRenderer=params.defaultRenderer||"newMapViewRenderer";this.locations=[];this.centre={lat:17,lon:0};this.synchronise=function(){this.locations=[];this.centre={lat:17,lon:0};if(this.edge.result){var results=this.edge.result.results();for(var i=0;i<results.length;i++){var res=results[i];var gp=this._getGeoPoint(res);if(gp){var ll=this._getLatLon(gp);ll["obj"]=res;this.locations.push(ll)}}}if(this.locations.length>0){this.centre=this.calculateCentre(this.locations)}};this._getLatLon=function(gp){var ll={};if(this.structure==="properties"){ll["lat"]=parseFloat(gp.lat);ll["lon"]=parseFloat(gp.lon)}return ll};this._getGeoPoint=function(obj){var parts=this.geoPoint.split(".");var context=obj;for(var i=0;i<parts.length;i++){var p=parts[i];var d=i<parts.length-1?{}:false;context=context[p]!==undefined?context[p]:d}return context}},MapCentreFunctions:{pickFirst:function(locations){return{lat:locations[0].lat,lon:locations[0].lon}}},newRegionDataMap:function(params){if(!params){params={}}edges.RegionDataMap.prototype=edges.newComponent(params);return new edges.RegionDataMap(params)},RegionDataMap:function(params){this.functions={sync:edges.getParam(params.synchronise,false)};this.regionData=edges.getParam(params.regionData,{});this.defaultRegionData=edges.getParam(params.defaultRegionData,false);this.defaultRenderer=edges.getParam(params.defaultRenderer,"newRegionDataMapRenderer");this.center=edges.getParam(params.center,false);this.superRegions=edges.getParam(params.superRegions,{});this.synchronise=function(){if(this.functions.sync){this.functions.sync(this)}};this.getSuperRegion=function(params){var region=params.region;for(var srn in this.superRegions){if($.inArray(region,this.superRegions[srn])!==-1){return srn}}return false}}});